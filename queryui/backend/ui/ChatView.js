import{d as L,r as ne,a as g,l as N,W as oe,o as ie,g as v,A as ce,b as de,c as i,e as c,f as e,h as C,i as x,n as S,u as o,j as d,k as E,t as _,F as B,m as le,w as re,v as ue,p as ve,q as _e,s as he,x as pe,_ as fe}from"./index.js";const h=w=>(_e("data-v-67c2af58"),w=w(),he(),w),me={id:"wrapper"},ge={id:"menu"},ye={class:"menu-button-holder"},ke={href:"/",id:"exit"},be={id:"disconnect"},Ce=h(()=>e("canvas",{id:"canvas",style:{display:"none"}},null,-1)),xe={id:"container"},we={id:"video-wrapper"},Ve=h(()=>e("span",null,null,-1)),Ie={"data-peer":"","data-state":"","data-camera":"",id:"video-section"},Me={id:"content"},Se={id:"video-box"},Te=h(()=>e("div",{class:"video",id:"peer-video-box"},[e("video",{id:"peer-video",autoplay:"",playsinline:""}),e("div",{class:"video-placeholder"},"Waiting for peer...")],-1)),De=h(()=>e("div",{class:"video",id:"user-video-box"},[e("video",{id:"user-video",muted:"",autoplay:"",playsinline:""}),e("div",{class:"video-placeholder"},"Attaching to camera...")],-1)),Ne=h(()=>e("input",{id:"audio",type:"checkbox",style:{display:"none"}},null,-1)),Be={id:"video-controls"},Ee=h(()=>e("span",null,null,-1)),Le={class:"control-button"},Pe={key:0,class:"muted"},Ae={key:1},ze={class:"next-button-holder"},Oe={class:"control-button"},je={key:0,class:"muted"},Re={key:1},Ke=h(()=>e("span",null,null,-1)),Ue=h(()=>e("div",{id:"resizer"},[e("span")],-1)),We={id:"sidebar"},Fe={id:"sidebar-content"},$e={class:"chat-container clearfix"},qe={class:"chat"},He={class:"chat-header clearfix"},Je={class:"chat-about"},Ye={key:0,class:"chat-with"},Ge={key:1,class:"chat-num-messages"},Qe={class:"chat-history"},Xe={key:0,class:"loader"},Ze=pe('<div class="wrapper" data-v-67c2af58><div class="circle" data-v-67c2af58></div><div class="circle" data-v-67c2af58></div><div class="circle" data-v-67c2af58></div><div class="shadow" data-v-67c2af58></div><div class="shadow" data-v-67c2af58></div><div class="shadow" data-v-67c2af58></div><span data-v-67c2af58>Loading...</span></div>',1),et=[Ze],tt={id:"chat-messages"},at={class:"message-data-name"},st={class:"message-data-time"},nt={class:"message-data-time"},ot={class:"message-data-name"},it={key:0},ct={class:"message-data align-right message-data-name"},dt={class:"message-data-name"},lt=h(()=>e("div",{class:"message other-message float-right"},[e("div",{className:"typing"},[e("div",{className:"typing__dot"}),e("div",{className:"typing__dot"}),e("div",{className:"typing__dot"})])],-1)),rt={key:0,class:"chat-message clearfix"},ut={key:2,id:"peer-left"},vt=L({__name:"ChatComp",setup(w){const k=ne([]);let r=g(""),p=g(""),b=g(!1),V=g(!1),I=g(!1),f=g(!1),u=g(!1),m=g(!0),M="rtc-state";const P=N(M);let a=new oe(P.name);a.on("connected",K),a.on("disconnected",U),a.on("peeradded",W),a.on("invite",F),a.on("peerremoved",$),a.on("peerupdated",q),a.on("peerconnected",H),a.on("peerdisconnected",J),a.on("offer",Y),a.on("chat",G),a.on("typing",Q),ie(()=>{O(),z(),y("state","ready");const t=v("#resizer"),s=v("#video-wrapper");t.addEventListener("mousedown",n=>{document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",l,!1)},!1)});function l(n){const D=s.getBoundingClientRect().left,se=`${n.x-D}px`;s.style.flexBasis=se}s.style.flexBasis="70%",console.log("App is ready")});function y(t,s){v("main").setAttribute(`data-${t}`,s)}function A(t){let s=N(M);t.name&&(a.name=t.name);const l={...s,...t};localStorage.setItem(M,JSON.stringify(l))}async function z(){y("camera","attaching");const t=N(M),s=v("#user-video");s.srcObject=null,t.audio?u.value=!0:u.value=!1,t.camera?(s.srcObject=await a.openStream({cameraId:t.camera,audioDisabled:!t.audio}),y("camera","attached"),m.value=!0,setInterval(()=>{ae()},5e3)):(m.value=!1,a.closeStream(),y("camera",""))}function O(){v("#disconnect").addEventListener("click",()=>{a.disconnect()})}function j(t){const s=t.target.value;t.key==="Enter"?(a.sendChat(s),f.value=!1,a.sendTyping(!1),T(s,void 0),t.target.value="",p.value=""):s.length===0&&!f.value&&t.key!="Backspace"?(f.value=!0,a.sendTyping(!0)):f.value&&s.length===1&&t.key==="Backspace"&&(f.value=!1,a.sendTyping(!1))}function R(){a.sendChat(p.value),f.value=!1,a.sendTyping(!1),T(p.value,void 0),p.value=""}function K(){console.log("Connected to signal server")}function U(){console.log("Disconnected from signal server")}function W(t){}function F(t){y("peer","connecting"),a==null||a.invite(t.id)}function $(t){a.disconnect()}function q(t){}function H(t){y("peer","connected"),r.value=t.peer.name,b.value=!0,V.value=!1;const s=v("#peer-video");s.srcObject=t.stream}function J(){const t=v("#peer-video");t.srcObject=null,y("peer",""),b.value=!1,V.value=!0,I.value=!1,f.value=!1}function Y(t){a.accept(t)}function G(t){T(t.message,t.peer)}function Q(t){I.value=t.typing}function X(){var t=new Date,s=t.getHours()+":"+t.getMinutes();return s}function T(t,s){k.push({me:!s,name:s?s.name:"Me",message:t,time:X()})}function Z(){r.value="",b.value=!1,V.value=!1,I.value=!1,f.value=!1,k.splice(0),a.disconnect(),a.next()}function ee(){u.value=!u.value,a.toggleMic(u.value),A({audio:u.value})}function te(){m.value=!m.value,a.toggleVideo(m.value)}function ae(){var t="",s=v("canvas"),l=v("#user-video");s.width=200,s.height=200,s.getContext("2d").drawImage(l,0,0,200,200),t=s.toDataURL(),ce.getEndpoints("statistics").get("capture")({clientId:a.id,data:t}).then(function(n){console.log("[Chat] Post capture response",n)})}return(t,s)=>{const l=de("font-awesome-icon");return i(),c("div",me,[e("div",ge,[e("div",ye,[e("a",ke,[e("span",null,[C(l,{icon:"fa-solid fa-xmark"})]),x("Exit")])]),e("button",be,[C(l,{icon:"fa-solid fa-xmark"})]),Ce]),e("div",xe,[e("div",we,[Ve,e("main",null,[e("section",Ie,[e("div",Me,[e("div",Se,[Te,De,Ne,e("div",Be,[Ee,e("div",Le,[e("button",{class:"inner",onClick:te},[e("span",{class:S(["video-icon",{disabled:o(m)}])},null,2)]),o(m)?d("",!0):(i(),c("span",Pe,"Video is disabled")),o(m)?(i(),c("span",Ae,"Video is enabled")):d("",!0)]),e("div",ze,[e("button",{class:"next",onClick:Z},[C(l,{icon:"fa-solid fa-rotate"})])]),e("div",Oe,[e("button",{id:"audio-control",class:"inner",onClick:ee},[o(u)?(i(),E(l,{key:0,icon:"fa fa-microphone-slash"})):d("",!0),o(u)?d("",!0):(i(),E(l,{key:1,icon:"fa-solid fa-microphone"}))]),o(u)?d("",!0):(i(),c("span",je,"Microphone is disabled")),o(u)?(i(),c("span",Re,"Microphone is enabled")):d("",!0)])]),Ke])])])])]),Ue,e("div",We,[e("section",Fe,[e("div",$e,[e("div",qe,[e("div",He,[e("div",Je,[o(r).length>0?(i(),c("div",Ye," You are chatting with "+_(o(r)),1)):d("",!0),k.length>0?(i(),c("div",Ge," already "+_(k.length)+" messages ",1)):d("",!0)])]),e("div",Qe,[o(r)?d("",!0):(i(),c("div",Xe,et)),e("ul",tt,[(i(!0),c(B,null,le(k,(n,D)=>(i(),c("li",{key:D,class:S({clearfix:!n.me})},[e("div",{class:S(["message-data",{"align-right":!n.me,"message-data-name":!n.me}])},[n.me?(i(),c(B,{key:0},[e("span",at,[C(l,{icon:"fa fa-circle",class:"me"}),x(" "+_(n.name),1)]),e("span",st,_(n.time),1),x("     ")],64)):d("",!0),n.me?d("",!0):(i(),c(B,{key:1},[e("span",nt,_(n.time),1),x("     "),e("span",ot,[x(_(n.name)+" ",1),C(l,{icon:"fa fa-circle",class:"online"})])],64))],2),e("div",{class:S(["message",{"float-right":!n.me,"other-message":!n.me,"my-message":n.me}])},_(n.message),3)],2))),128)),o(I)?(i(),c("li",it,[e("div",ct,[e("span",dt,[x(_(o(r))+" ",1),C(l,{icon:"fa fa-circle",class:"online"})])]),lt])):d("",!0)])]),o(b)||o(V)&&o(r)?(i(),c("div",rt,[o(b)?re((i(),c("input",{key:0,name:"message-to-send",id:"chat-input",placeholder:"Type your message",onKeydown:j,"onUpdate:modelValue":s[0]||(s[0]=n=>ve(p)?p.value=n:p=n)},null,544)),[[ue,o(p)]]):d("",!0),o(b)?(i(),c("button",{key:1,id:"chat-button",onClick:R},"Send")):d("",!0),o(V)&&o(r)?(i(),c("span",ut,_(o(r))+" left the chat",1)):d("",!0)])):d("",!0)])])])])])])}}});const _t=fe(vt,[["__scopeId","data-v-67c2af58"]]),pt=L({__name:"ChatView",setup(w){return(k,r)=>(i(),E(_t))}});export{pt as default};
